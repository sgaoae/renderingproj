!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("three")):"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.rendering=t(require("three")):e.rendering=t(e.THREE)}(window,(function(e){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(0);var r=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.uniforms={color:{type:"v3",value:new i.Color(e.color)},light:{type:"v3",value:new i.Vector3},lightColor:{type:"v3",value:new i.Color(.2,.5,1)},heightInterval:{type:"f",value:40},lineWidth:{type:"f",value:10},headLight0:{value:{projectionMatrix:new i.Matrix4,matrixWorldInverse:new i.Matrix4}},headLight1:{value:{projectionMatrix:new i.Matrix4,matrixWorldInverse:new i.Matrix4}}},n.vertexShader=a,n.fragmentShader=l,n.side=e.side,n.wireframe=e.wireframe,n.extensions.derivatives=!0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"light",set:function(e){this.uniforms.light.value=e}},{key:"lightColor",set:function(e){this.uniforms.lightColor.value=e}},{key:"heightInterval",set:function(e){this.uniforms.heightInterval.value=e}},{key:"lineWidth",set:function(e){this.uniforms.lineWidth.value=e}}]),t}(i.ShaderMaterial),a="\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec3 vLight;\n\nvarying vec3 modelPosition;\nvarying float slope;\n\nuniform vec3 light;\n\nmat4 scaleBiasedMatrix = mat4(0.5, 0.0, 0.0, 0.0,\n  0.0, 0.5, 0.0, 0.0,\n  0.0, 0.0, 0.5, 0.0,\n  0.5, 0.5, 0.5, 1.0);\nstruct HeadLight {\n  mat4 projectionMatrix;\n  mat4 matrixWorldInverse;\n  vec3 color;\n  vec3 worldPosition;\n  float coneCos;\n};\nuniform HeadLight headLight0;\nvarying vec4 hlPosition0;\n\nuniform HeadLight headLight1;\nvarying vec4 hlPosition1;\n\nvoid main () {\n  modelPosition = position;\n  slope = normalize(normal).z;\n\n  vec4 inPosition = vec4(position, 1.0);\n  vec4 vPosition4 = modelViewMatrix * inPosition;\n  vPosition = vPosition4.xyz / vPosition4.w;\n  vec4 vLight4 = modelViewMatrix * vec4(\n    light.x, light.y, light.z + 10.0, 1.0\n  );\n  vLight = vLight4.xyz / vLight4.w;\n  vNormal = normalize(normalMatrix * normal);\n  vec4 modelPosition = modelViewMatrix * inPosition;\n  gl_Position = projectionMatrix * modelPosition;\n\n  hlPosition0 = scaleBiasedMatrix * headLight0.projectionMatrix * headLight0.matrixWorldInverse * modelMatrix * inPosition;\n  hlPosition1 = scaleBiasedMatrix * headLight1.projectionMatrix * headLight1.matrixWorldInverse * modelMatrix * inPosition;\n}\n",l="\n#include <common>\n#include <bsdfs>\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec3 vLight;\nuniform vec3 color;\nuniform vec3 lightColor;\n\nvarying vec3 modelPosition;\nvarying float slope;\nuniform float heightInterval;\nuniform float lineWidth;\n\nstruct HeadLight {\n  mat4 projectionMatrix;\n  mat4 matrixWorldInverse;\n  vec3 color;\n  vec3 worldPosition;\n  float coneCos;\n};\nuniform HeadLight headLight0;\nvarying vec4 hlPosition0;\n\nuniform HeadLight headLight1;\nvarying vec4 hlPosition1;\n\nvoid main () {\n  vec3 finalColor = vec3(0.0);\n  finalColor += color * clamp(dot(normalize(vec3(1.0)), vNormal), 0.0, 1.0);\n\n  float f = abs(2.0 * fract(modelPosition.z / heightInterval) - 1.0);\n  float df = fwidth(modelPosition.z / heightInterval);\n  float fLimit0 = lineWidth / heightInterval * (1.0 + slope);\n  float fLimit = fLimit0;\n  float lineMix = f < fLimit ? f / fLimit : 1.0;\n  vec4 lineColor = vec4(0.0, 0.0, 1.0, 1.0);\n\n  finalColor = mix(lineColor, vec4(finalColor, 1.0), lineMix).rgb;\n\n  vec3 direction = normalize(vLight - vPosition);\n  float ndotl = clamp(dot(direction, vNormal), 0.0, 1.0);\n  finalColor += lightColor * ndotl;\n\n  float x0 = hlPosition0.x / hlPosition0.w;\n  float y0 = hlPosition0.y / hlPosition0.w;\n  float z0 = hlPosition0.z / hlPosition0.w;\n  float x1 = hlPosition1.x / hlPosition1.w;\n  float y1 = hlPosition1.y / hlPosition1.w;\n  float z1 = hlPosition1.z / hlPosition1.w;\n  float a0 = step(0.0, x0) - step(1.0, x0);\n  float b0 = step(0.0, y0) - step(1.0, y0);\n  float c0 = step(0.0, z0) - step(1.0, z0);\n  float a1 = step(0.0, x1) - step(1.0, x1);\n  float b1 = step(0.0, y1) - step(1.0, y1);\n  float c1 = step(0.0, z1) - step(1.0, z1);\n  if (\n    (a0 == 1.0 && b0 == 1.0 && c0 == 1.0) ||\n    (a1 == 1.0 && b1 == 1.0 && c1 == 1.0)\n  ) {\n    vec3 hlColor0 = vec3(0.0);\n    vec3 hlColor1 = vec3(0.0);\n    float angleCos;\n    float lightDistance;\n    lightDistance = length(headLight0.worldPosition - vPosition);\n    angleCos = dot(\n      normalize(vec3(x0, y0, z0) - vec3(0.5)),\n      vec3(0, 0, 1)\n    );\n    if (angleCos > headLight0.coneCos) {\n      float spotEffect = smoothstep( headLight0.coneCos, 1.0, angleCos );\n      hlColor0 = vec3(spotEffect) * headLight0.color * punctualLightIntensityToIrradianceFactor(\n        lightDistance, 18000.0, 1.0\n      );\n    }\n    lightDistance = length(headLight1.worldPosition - vPosition);\n    angleCos = dot(\n      normalize(vec3(x1, y1, z1) - vec3(0.5)),\n      vec3(0, 0, 1)\n    );\n    if (angleCos > headLight1.coneCos) {\n      float spotEffect = smoothstep( headLight1.coneCos, 1.0, angleCos );\n      hlColor1 = vec3(spotEffect) * headLight1.color * punctualLightIntensityToIrradianceFactor(\n        lightDistance, 18000.0, 1.0\n      );\n    }\n    finalColor += mix(vec4(hlColor0, 1.0), vec4(hlColor1, 1.0), 0.5).xyz;\n  }\n\n  gl_FragColor = vec4(finalColor, 1.0);\n}\n";t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSpriteWithNumber=void 0;var o=n(0);t.createSpriteWithNumber=function(){var e=document.createElement("canvas");e.width=512,e.height=256;var t=e.getContext("2d");t.fillStyle="black",t.fillRect(0,0,512,256),t.fillStyle="red",t.font="300px Arial";var n=new o.Texture(e);n.needsUpdate=!0;var i=new o.Sprite(new o.SpriteMaterial({map:n,color:16777215}));return i.material.needsUpdate=!0,i.needsUpdate=!0,i.needsUpdate=!0,i.scale.set(2,1,1),{sprite:i,drawNumber:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t.clearRect(0,0,512,256),t.fillStyle="red",t.font="300px Arial",t.fillText(e,0===n?168:60,236),i.material.map.needsUpdate=!0,i.material.needsUpdate=!0,i.needsUpdate=!0}}}},function(e,t,n){e.exports=n(4)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.help1=void 0;var o=n(0),i=u(n(1)),r=u(n(5)),a=u(n(6)),l=u(n(7)),c=n(8),s=u(n(9)),d=n(2);function u(e){return e&&e.__esModule?e:{default:e}}var h=void 0,f=void 0,p=void 0,v=void 0,m=void 0,w=void 0;!function(){(p=new o.WebGLRenderer({antialias:!0})).context.getExtension("GL_OES_standard_derivatives"),p.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(p.domElement),h=new o.Scene,window.scene=h,f=new o.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e5),v=new o.Object3D;var e=new o.AxesHelper(400);v.add(e),m=new a.default({camera:v,face:new o.Vector3(1,0,0),domElement:document.body}),w=new l.default,document.body.appendChild(w.domElement)}(),window.addEventListener("resize",(function(e){p.setSize(window.innerWidth,window.innerHeight),f.aspect=window.innerWidth/window.innerHeight,f.updateProjectionMatrix()}),!1),window.camera=f,window.renderer=p,window.controls=m;var y=new o.CubeGeometry(8e3,8e3,8e3),g=[new o.MeshBasicMaterial({map:(new o.TextureLoader).load("./examples/back.jpg"),side:o.DoubleSide}),new o.MeshBasicMaterial({map:(new o.TextureLoader).load("./examples/front.jpg"),side:o.DoubleSide}),new o.MeshBasicMaterial({map:(new o.TextureLoader).load("./examples/top.jpg"),side:o.DoubleSide}),new o.MeshBasicMaterial({map:(new o.TextureLoader).load("./examples/bottom.jpg"),side:o.DoubleSide}),new o.MeshBasicMaterial({map:(new o.TextureLoader).load("./examples/right.jpg"),side:o.DoubleSide}),new o.MeshBasicMaterial({map:(new o.TextureLoader).load("./examples/left.jpg"),side:o.DoubleSide})],x=new o.MeshFaceMaterial(g),b=new o.Mesh(y,x);b.rotateX(Math.PI/2);var M=new r.default(8e3,8e3,200,200);M.content.material=new i.default({color:3615541,wireframe:!1,side:o.DoubleSide}),m._heightField=M;var _=M.content.geometry,P=M.content.material;window.geometry=_,window.material=P,M.content.material.light=f.position;var C=new o.Object3D;C.add(M.content),C.add(b),h.add(C),f.position.copy(_.vertices[M.getVerticeIndex(40,40,M._rows,M._columns)]),f.position.z+=m._extraHeight,f.up.set(0,0,1);var z=new o.Vector3(1,0,0),S=m.cameraLookAt;window.cameraLookAt=S,S(f.position.clone(),f.up.clone(),z.clone());for(var L=[],j=0;j<5;++j){var I=new s.default({radius:1.1*(10+15*Math.random())});I.position.copy(_.vertices[M.getVerticeIndex(18+j,25,M._rows,M._columns)]),I.position.z=M.heightByFormula(I.position)+30,L.push(I),h.add(I)}window.bubbles=L;var V=function(e){var t=L[e];t.visible=!1,t.cubeCamera.update(p,h),t.visible=!0},k=function(){L.map((function(e){e.acceleration=new o.Vector3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1).multiplyScalar(10)}))},R=function(e,t,n,i){for(var r=[new o.Vector3(n.max.x,n.max.y,n.max.z),new o.Vector3(n.max.x,n.max.y,n.min.z),new o.Vector3(n.max.x,n.min.y,n.max.z),new o.Vector3(n.max.x,n.min.y,n.min.z),new o.Vector3(n.min.x,n.max.y,n.max.z),new o.Vector3(n.min.x,n.max.y,n.min.z),new o.Vector3(n.min.x,n.min.y,n.max.z),new o.Vector3(n.min.x,n.min.y,n.min.z)],a=0;a<r.length;++a){if(r[a].applyMatrix4(i.matrixWorld).sub(e).length()<=t)return!0}return!1},O=new o.PerspectiveCamera(120,1,.1,1e3);O.quaternion.set(0,0,0,1),O.scale.set(1,1,1),O.position.copy(new o.Vector3(-2.2,3.4,-7.1).multiplyScalar(2)),O.rotateX(-Math.PI/6),O.rotateY(Math.PI/10),v.add(O),M.content.material.uniforms.headLight0.value=O,window.camera0=O;var B=new o.PerspectiveCamera(120,1,.1,1e3);B.quaternion.set(0,0,0,1),B.scale.set(1,1,1),B.position.copy(new o.Vector3(2.2,3.4,-7.1).multiplyScalar(2)),B.rotateX(-Math.PI/6),B.rotateY(-Math.PI/10),v.add(B),M.content.material.uniforms.headLight1.value=B,window.camera1=B,O.color=new o.Color(1,.3,0),B.color=new o.Color(1,.3,0);var E=(0,d.createSpriteWithNumber)();E.sprite.position.set(0,0,-40),E.sprite.scale.set(70,35,35),E.sprite.center.y=0,E.drawNumber("5"),v.add(E.sprite),h.add(v),v.position.copy(_.vertices[M.getVerticeIndex(20,20,M._rows,M._columns)]),v.position.z+=m._extraHeight,v.up.set(0,0,1),S(v.position.clone(),v.up.clone(),z.clone()),window.angle=40;var F=new o.Clock,T=!1,W=0;window.accTime=W,window.score=0;var N=4,D=!0,H=function e(){requestAnimationFrame(e),window.accTime=W;var t=F.getDelta();if(W<=5.4){var n=Math.floor(5.4-W);E.drawNumber(n.toString())}W+=t,window.orbitControls&&!T&&window.orbitControls.update(),m&&W>5&&(D&&(E.sprite.visible=!1,D=!1),m.update(t)),w.update(),M.content.material.light=v.position.clone().add(new o.Vector3(0,0,80)).add(m._face.clone().multiplyScalar(40)),O.updateMatrix(),O.updateMatrixWorld(),O.updateProjectionMatrix(),O.matrixWorldInverse=(new o.Matrix4).getInverse(O.matrixWorld),O.worldPosition=(new o.Vector3).setFromMatrixPosition(O.matrixWorld),O.coneCos=Math.cos(window.angle*Math.PI/180),B.updateMatrix(),B.updateMatrixWorld(),B.updateProjectionMatrix(),B.matrixWorldInverse=(new o.Matrix4).getInverse(B.matrixWorld),B.worldPosition=(new o.Vector3).setFromMatrixPosition(B.matrixWorld),B.coneCos=Math.cos(window.angle*Math.PI/180),function(e){var t=[];e.traverse((function(e){e.isMesh&&t.push(e)}));for(var n=[],o=0;o<L.length;++o){for(var i=L[o],r=!1,a=0;a<t.length;++a){var l=t[a];if(R(i.position,i.radius,l.geometry.boundingBox,l)){r=!0;break}}n.push(r)}return n}(v).map((function(e,t){e&&(L[t].position.copy(new o.Vector3(3e3*Math.random(),3e3*Math.random(),0)),window.score+=L[t].score,E.sprite.visible=!0,E.drawNumber("+"+L[t].score.toString(),1),setTimeout((function(){E.sprite.visible=!1}),500),N=5)}));for(var i=0;i<N;++i)L[i].move(t,M);!function(){for(var e=0;e<L.length;++e)V(e)}(),p.render(h,f)},A=function(){var e=new THREE.Color(16777215);e.setHex(16777215*Math.random()),P.uniforms.color.value=e};window.cameraFollowCar=function(){v.add(f),f.quaternion.set(0,0,0,1),f.scale.set(1,1,1),f.position.copy(new o.Vector3(-1.7,5.9,-.5).multiplyScalar(2)),f.updateProjectionMatrix(),T=!0},window.cameraOut=function(){v.remove(f),f.position.copy(v.position),T=!1},(0,c.loadmtlobj)("./public/obj/BMW X5 4.mtl","./public/obj/BMW X5 4.obj",(function(e){e.rotateY(-Math.PI/2);e.children.map((function(e){e.material=new o.MeshBasicMaterial({color:e.material.color,transparent:!0,opacity:.7}),e.geometry.computeBoundingBox(),e.geometry.boundingBox.min.x-=10,e.geometry.boundingBox.min.y-=10,e.geometry.boundingBox.min.z-=10,e.geometry.boundingBox.max.x+=10,e.geometry.boundingBox.max.y+=10,e.geometry.boundingBox.max.z+=10})),e.scale.set(.2,.2,.2),v.add(e),window.object=v;var t=m._keyMap.w;m._keyMap.w=!0,m.update(0),m._keyMap.w=t,console.log("load complete"),setInterval(A,1500),setInterval(k,3e3),cameraFollowCar(),H()}),(function(e){console.warn("error",e)}));t.help1=function(){console.log("help1")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(0),a=n(1);(o=a)&&o.__esModule;var l=function(){function e(t,n,o,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._width=t,this._height=n,this._rows=o,this._columns=i,this._geometryInfo=this._createHeightField(t,n,o,i);var l=new r.Geometry;l.vertices=this._geometryInfo.vertices,l.faces=this._geometryInfo.faces,l.computeBoundingSphere(),l.computeVertexNormals(),this.content=new r.Mesh(l,{})}return i(e,[{key:"_createHeightField",value:function(){for(var e=Date.now(),t=this._rows,n=this._columns,o=this._width,i=this._height,a=[],l=0;l<t;++l)for(var c=0;c<n;++c)a.push(new r.Vector3(-o/2+l/(t-1)*o,-i/2+c/(n-1)*i,0));var s=Date.now();console.log(s-e);for(var d=[],u=0;u<t-1;++u)for(var h=0;h<n-1;++h)d.push(new r.Face3(this.getVerticeIndex(u,h,t,n),this.getVerticeIndex(u+1,h+1,t,n),this.getVerticeIndex(u+1,h,t,n))),d.push(new r.Face3(this.getVerticeIndex(u+1,h+1,t,n),this.getVerticeIndex(u,h,t,n),this.getVerticeIndex(u,h+1,t,n)));var f=Date.now();console.log(f-s);for(var p=0;p<t;++p)for(var v=0;v<n;++v){var m=a[this.getVerticeIndex(p,v,t,n)];m.z+=this.heightByFormula(m.clone(),o,i)}return{vertices:a,faces:d}}},{key:"getVerticeIndex",value:function(e,t,n,o){return e+t*n}},{key:"heightByFormula",value:function(e){var t=e.clone().sub(new r.Vector3(this._width/2,this._height/2));t.z=0;var n=Math.PI/2,o=Math.max(1,1e-4*t.length());return 300*(Math.max(0,Math.sin(.003*(t.x+t.y))+1*Math.sin(.0039999*t.x+n)+0)+Math.max(0,Math.sin(.003*(t.y+.5*t.x))+1*Math.sin(.0059661*t.y+n)+0))/4/o}},{key:"normalInPoint",value:function(e){this._rows,this._columns,this._width,this._height;var t=new r.Vector3(e.x,e.y,this.heightByFormula(e)),n=new r.Vector3(e.x+.001,e.y,0);n.z=this.heightByFormula(n);var o=new r.Vector3(e.x,e.y+.001,0);return o.z=this.heightByFormula(o),(new r.Vector3).crossVectors(n.sub(t),o.sub(t)).normalize()}}]),e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(0);var r=function(){function e(t){var n=this,o=t.camera,i=t.face,r=t.heightField,a=t.domElement;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._camera=o,this._heightField=r,this._face=i,this._theta=0,this._speed=0,this._extraHeight=5,this.cameraLookAt=this.cameraLookAt.bind(this),this._keyMap={},a.addEventListener("keydown",(function(e){n._keyMap[e.key]=!0}),!1),a.addEventListener("keyup",(function(e){n._keyMap[e.key]=!1}),!1),this._prevNormal=void 0,this._realFace=void 0}return o(e,[{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=200,n=500,o=this._camera,i=this._heightField;this._speed>0?this._speed=this._speed-t*e>0?this._speed-t*e:0:this._speed<0&&(this._speed=this._speed+t*e<0?this._speed+t*e:0),this._keyMap.w&&(this._speed+=(t+50)*e),this._keyMap.s&&(this._speed-=(t+50)*e),this._speed>n&&(this._speed=n),this._speed<-n&&(this._speed=-n);var r=o.position.clone().add(this._face.clone().multiplyScalar(this._speed*e));r.z=0,r.z=i.heightByFormula(r.clone()),r.z+=this._extraHeight;var a=i.normalInPoint(r);this._prevNormal&&a.copy(this._prevNormal.clone().add(a.clone().sub(this._prevNormal).multiplyScalar(e))).normalize(),this._prevNormal=a.clone();var l=this._face.clone().sub(a.clone().multiplyScalar(this._face.dot(a)/this._face.length()));this.cameraLookAt(r,a,l),this._updateDirection(),this._realFace=l;var c=3900;if(r.x>c||r.x<-c){var s=r.x*this._speed*this._face.x;s>0&&(this._speed=-this._speed)}if(r.y>c||r.y<-c){var d=r.y*this._speed*this._face.y;d>0&&(this._speed=-this._speed)}}},{key:"_updateDirection",value:function(){this._keyMap.a&&(this._face.set(Math.cos(this._theta),Math.sin(this._theta),0),this._theta+=.02),this._keyMap.d&&(this._face.set(Math.cos(this._theta),Math.sin(this._theta),0),this._theta-=.02)}},{key:"cameraLookAt",value:function(e,t,n){var o=this._camera;o.matrix.setPosition(e).lookAt(e,n.clone().add(e),t),o.matrix.decompose(o.position,o.quaternion,new i.Vector3)}}]),e}();t.default=r},function(e,t,n){var o=function(){function e(e){return i.appendChild(e.dom),e}function t(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";n=e}var n=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(e){e.preventDefault(),t(++n%i.children.length)}),!1);var r=(performance||Date).now(),a=r,l=0,c=e(new o.Panel("FPS","#0ff","#002")),s=e(new o.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var d=e(new o.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:i,addPanel:e,showPanel:t,begin:function(){r=(performance||Date).now()},end:function(){l++;var e=(performance||Date).now();if(s.update(e-r,200),e>a+1e3&&(c.update(1e3*l/(e-a),100),a=e,l=0,d)){var t=performance.memory;d.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){r=this.end()},domElement:i,setMode:t}};o.Panel=function(e,t,n){var o=1/0,i=0,r=Math.round,a=r(window.devicePixelRatio||1),l=80*a,c=48*a,s=3*a,d=2*a,u=3*a,h=15*a,f=74*a,p=30*a,v=document.createElement("canvas");v.width=l,v.height=c,v.style.cssText="width:80px;height:48px";var m=v.getContext("2d");return m.font="bold "+9*a+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=n,m.fillRect(0,0,l,c),m.fillStyle=t,m.fillText(e,s,d),m.fillRect(u,h,f,p),m.fillStyle=n,m.globalAlpha=.9,m.fillRect(u,h,f,p),{dom:v,update:function(c,w){o=Math.min(o,c),i=Math.max(i,c),m.fillStyle=n,m.globalAlpha=1,m.fillRect(0,0,l,h),m.fillStyle=t,m.fillText(r(c)+" "+e+" ("+r(o)+"-"+r(i)+")",s,d),m.drawImage(v,u+a,h,f-a,p,u,h,f-a,p),m.fillRect(u+f-a,h,a,p),m.fillStyle=n,m.globalAlpha=.9,m.fillRect(u+f-a,h,a,r((1-c/w)*p))}}},e.exports=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t,n,o){(new THREE.MTLLoader).load(e,t,n,o)},i=function(e,t,n,o,i){(new THREE.OBJLoader).setMaterials(t).load(e,n,o,i)};t.loadmtl=o,t.loadobj=i,t.loadmtlobj=function(e,t,n,r){o(e,(function(e){console.log(e),i(t,e,n,void 0,r)}),void 0,r)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(0),r=n(2);var a=function(e){function t(e){var n=e.radius;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),a=n/25*256,s=Math.round(Math.log2(a));a=Math.pow(2,s);var d=new i.CubeCamera(1,8e3,a);console.log(n,s,a),o.cubeCamera=d,o.add(d);var u=new i.SphereBufferGeometry(1,16,16);o.radius=n;var h=new i.ShaderMaterial({uniforms:{refractRatio:{type:"f",value:1.02},fresnelBias:{type:"f",value:.1},fresnelPower:{type:"f",value:2},fresnelScale:{type:"f",value:1},tCube:{type:"t",value:d.renderTarget},color:{type:"v3",value:new i.Color(16777215)}},vertexShader:l,fragmentShader:c}),f=new i.Mesh(u,h);return f.scale.set(n,n,n),o.add(f),o._bubble=f,o.score=Math.floor(n/25*10),o.score=o.score>9?9:o.score,o.spriteManager=(0,r.createSpriteWithNumber)(),o.spriteManager.sprite.position.z=1.5*n,o.spriteManager.sprite.scale.set(40,20,20),o.spriteManager.sprite.material.depthTest=!1,o.add(o.spriteManager.sprite),o.spriteManager.drawNumber(o.score.toString()),o.velocity=new i.Vector3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1).multiplyScalar(200),o.acceleration=new i.Vector3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1).multiplyScalar(10),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"move",value:function(e,t){this.position.add(this.velocity.clone().multiplyScalar(e)),this.velocity.add(this.acceleration.clone().multiplyScalar(e)),Math.abs(this.position.x)>3e3&&(this.velocity.x=this.position.x*this.velocity.x>=0?-this.velocity.x:this.velocity.x),Math.abs(this.position.y)>3e3&&(this.velocity.y=this.position.y*this.velocity.y>=0?-this.velocity.y:this.velocity.y);var n=t.heightByFormula(this.position)+this.radius+.1;this.position.z<n&&(this.position.z=n),this.position.z>n+5&&(this.position.z=n+5)}},{key:"color",set:function(e){this._bubble.material.uniforms.color.value=new i.Color(e)}}]),t}(i.Object3D),l="\nuniform float refractRatio;\nuniform float fresnelBias;\nuniform float fresnelScale;\nuniform float fresnelPower;\n\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\n\nvoid main() {\n\n  vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n  vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n  vec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );\n\n  vec3 I = worldPosition.xyz - cameraPosition;\n\n  vReflect = reflect( I, worldNormal );\n  vRefract[0] = refract( normalize( I ), worldNormal, refractRatio );\n  vRefract[1] = refract( normalize( I ), worldNormal, refractRatio * 0.99 );\n  vRefract[2] = refract( normalize( I ), worldNormal, refractRatio * 0.98 );\n  vReflectionFactor = fresnelBias + fresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), fresnelPower );\n\n  gl_Position = projectionMatrix * mvPosition;\n\n}\n",c="\nuniform samplerCube tCube;\nuniform vec3 color;\n\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\n\nvoid main() {\n\n  vec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n  vec4 refractedColor = vec4( 1.0 );\n\n  refractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\n  refractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\n  refractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\n\n  gl_FragColor = vec4(color, 1.0) * mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n\n}\n";t.default=a}])}));